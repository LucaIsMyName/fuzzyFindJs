(function(u,z){typeof exports=="object"&&typeof module<"u"?z(exports):typeof define=="function"&&define.amd?define(["exports"],z):(u=typeof globalThis<"u"?globalThis:u||self,z(u.FuzzyFindJS={}))})(this,(function(u){"use strict";const z={languages:["english"],features:["phonetic","compound","synonyms","keyboard-neighbors","partial-words","missing-letters","extra-letters","transpositions"],performance:"balanced",maxResults:10,minQueryLength:2,fuzzyThreshold:.75,maxEditDistance:2,ngramSize:3},C={fast:{performance:"fast",features:["partial-words","missing-letters"],maxEditDistance:1,fuzzyThreshold:.9,maxResults:3},balanced:{performance:"balanced",features:["phonetic","partial-words","missing-letters","keyboard-neighbors"],maxEditDistance:2,fuzzyThreshold:.8,maxResults:5},comprehensive:{performance:"comprehensive",features:["phonetic","compound","synonyms","keyboard-neighbors","partial-words","missing-letters","extra-letters","transpositions"],maxEditDistance:3,fuzzyThreshold:.7,maxResults:10}},T={german:["phonetic","compound","synonyms","keyboard-neighbors","partial-words","missing-letters","extra-letters"],english:["phonetic","synonyms","keyboard-neighbors","partial-words","missing-letters","transpositions"],spanish:["phonetic","synonyms","keyboard-neighbors","partial-words","missing-letters"],french:["phonetic","synonyms","keyboard-neighbors","partial-words","missing-letters"]};function P(a={}){const n={...z};if(a.performance&&a.performance!=="balanced"){const e=C[a.performance];Object.assign(n,e)}const t={...n,...a};if(!a.features&&a.languages){const e=new Set;for(const r of a.languages)(T[r]||T.english).forEach(o=>e.add(o));t.features=Array.from(e)}return t}function $(a){if(a.maxResults<1)throw new Error("maxResults must be at least 1");if(a.minQueryLength<1)throw new Error("minQueryLength must be at least 1");if(a.fuzzyThreshold<0||a.fuzzyThreshold>1)throw new Error("fuzzyThreshold must be between 0 and 1");if(a.maxEditDistance<0)throw new Error("maxEditDistance must be non-negative");if(a.ngramSize<2)throw new Error("ngramSize must be at least 2");if(a.languages.length===0)throw new Error("At least one language must be specified")}class k{normalize(n){return n.toLowerCase().trim().replace(/\s+/g," ")}getPhoneticCode(n){const t=this.normalize(n);if(t.length===0)return"";let e=t[0].toUpperCase();const r={b:"1",f:"1",p:"1",v:"1",c:"2",g:"2",j:"2",k:"2",q:"2",s:"2",x:"2",z:"2",d:"3",t:"3",l:"4",m:"5",n:"5",r:"6"};for(let s=1;s<t.length&&e.length<4;s++){const o=t[s],i=r[o];i&&i!==e[e.length-1]&&(e+=i)}return e.padEnd(4,"0")}splitCompoundWords(n){return[n]}getWordVariants(n){const t=new Set,e=this.normalize(n);t.add(e),t.add(n);const r=this.getCommonEndings();for(const s of r)e.endsWith(s)&&e.length>s.length+2&&t.add(e.slice(0,-s.length));if(e.length>4)for(let s=3;s<e.length;s++)t.add(e.slice(0,s));return Array.from(t)}getCommonEndings(){return["s","es","ed","ing","er","est"]}getSynonyms(n){return[]}isValidSubstitution(n,t){const r=this.getKeyboardNeighbors()[n.toLowerCase()];return r?r.includes(t.toLowerCase()):!1}getKeyboardNeighbors(){return{q:["w","a","s"],w:["q","e","a","s","d"],e:["w","r","s","d","f"],r:["e","t","d","f","g"],t:["r","y","f","g","h"],y:["t","u","g","h","j"],u:["y","i","h","j","k"],i:["u","o","j","k","l"],o:["i","p","k","l"],p:["o","l"],a:["q","w","s","z","x"],s:["q","w","e","a","d","z","x","c"],d:["w","e","r","s","f","x","c","v"],f:["e","r","t","d","g","c","v","b"],g:["r","t","y","f","h","v","b","n"],h:["t","y","u","g","j","b","n","m"],j:["y","u","i","h","k","n","m"],k:["u","i","o","j","l","m"],l:["i","o","p","k"],z:["a","s","x"],x:["a","s","d","z","c"],c:["s","d","f","x","v"],v:["d","f","g","c","b"],b:["f","g","h","v","n"],n:["g","h","j","b","m"],m:["h","j","k","n"]}}generateNgrams(n,t=3){const e=this.normalize(n);if(e.length<t)return[e];const r=[];for(let s=0;s<=e.length-t;s++)r.push(e.slice(s,s+t));return r}calculateEditDistance(n,t){const e=[],r=n.length,s=t.length;for(let o=0;o<=r;o++)e[o]=[o];for(let o=0;o<=s;o++)e[0][o]=o;for(let o=1;o<=r;o++)for(let i=1;i<=s;i++){const c=n[o-1]===t[i-1]?0:1;e[o][i]=Math.min(e[o-1][i]+1,e[o][i-1]+1,e[o-1][i-1]+c)}return e[r][s]}}class x extends k{language="german";displayName="Deutsch";supportedFeatures=["phonetic","compound","synonyms","keyboard-neighbors","partial-words","missing-letters","extra-letters"];normalize(n){return n.toLowerCase().trim().replace(/\s+/g," ").replace(/ä/g,"ae").replace(/ö/g,"oe").replace(/ü/g,"ue").replace(/ß/g,"ss")}getPhoneticCode(n){const t=this.normalize(n);if(t.length===0)return"";let e="",r="";for(let s=0;s<t.length;s++){const o=t[s],i=s<t.length-1?t[s+1]:"";let c="";switch(o){case"a":case"e":case"i":case"j":case"o":case"u":case"y":c="0";break;case"h":continue;case"b":case"p":c="1";break;case"d":case"t":i==="c"||i==="s"||i==="z"?c="8":c="2";break;case"f":case"v":case"w":c="3";break;case"g":case"k":case"q":c="4";break;case"c":s===0?i==="a"||i==="h"||i==="k"||i==="l"||i==="o"||i==="q"||i==="r"||i==="u"||i==="x"?c="4":c="8":r==="s"||r==="z"?c="8":i==="h"||i==="k"||i==="q"?c="4":c="8";break;case"x":r==="c"||r==="k"||r==="q"?c="8":c="48";break;case"l":c="5";break;case"m":case"n":c="6";break;case"r":c="7";break;case"s":case"z":c="8";break;default:continue}c&&c!==r&&(e+=c),r=c}return e||"0"}splitCompoundWords(n){const t=this.normalize(n);if(t.length<6)return[n];const e=[],r=this.getCommonPrefixes(),s=this.getCommonSuffixes(),o=this.getCommonWords();for(const i of r)if(t.startsWith(i)&&t.length>i.length+3){const c=t.slice(i.length);e.push(i),e.push(...this.splitCompoundWords(c));break}if(e.length===0){for(const i of s)if(t.endsWith(i)&&t.length>i.length+3){const c=t.slice(0,-i.length);e.push(...this.splitCompoundWords(c)),e.push(i);break}}if(e.length===0)for(let i=3;i<=t.length-3;i++){const c=t.slice(0,i),l=t.slice(i);if(o.has(c)&&l.length>=3){e.push(c),e.push(...this.splitCompoundWords(l));break}}return e.length>0?e:[n]}getWordVariants(n){const t=new Set,e=this.normalize(n);t.add(e),t.add(n),this.splitCompoundWords(n).forEach(o=>t.add(this.normalize(o)));const s=this.getCommonEndings();for(const o of s)e.endsWith(o)&&e.length>o.length+2&&t.add(e.slice(0,-o.length));if(e.length>4)for(let o=3;o<e.length;o++)t.add(e.slice(0,o));return Array.from(t)}getCommonEndings(){return["en","e","er","n","r","s","es","t","ung","heit","keit","schaft","chen","lein","lich","ig","isch","bar","los","voll"]}getSynonyms(n){const t={arzt:["doktor","mediziner","doc"],krankenhaus:["spital","klinik","hospital"],schule:["bildungseinrichtung","lehranstalt"],auto:["wagen","fahrzeug","pkw"],haus:["gebaeude","heim","wohnhaus"],strasse:["weg","gasse","allee"],stadt:["ort","gemeinde","ortschaft"],arbeit:["job","beruf","taetigkeit"],geld:["waehrung","kapital","finanzen"],zeit:["dauer","periode","zeitraum"]},e=this.normalize(n);return t[e]||[]}getKeyboardNeighbors(){return{q:["w","a","s"],w:["q","e","a","s","d"],e:["w","r","s","d","f"],r:["e","t","d","f","g"],t:["r","z","f","g","h"],z:["t","u","g","h","j"],u:["z","i","h","j","k"],i:["u","o","j","k","l"],o:["i","p","k","l","oe"],p:["o","ue","l","oe"],ue:["p","ae"],a:["q","w","s","y","x"],s:["q","w","e","a","d","y","x","c"],d:["w","e","r","s","f","x","c","v"],f:["e","r","t","d","g","c","v","b"],g:["r","t","z","f","h","v","b","n"],h:["t","z","u","g","j","b","n","m"],j:["z","u","i","h","k","n","m"],k:["u","i","o","j","l","m"],l:["i","o","p","k","oe"],oe:["o","p","ue","l","ae"],ae:["ue","oe"],y:["a","s","x"],x:["a","s","d","y","c"],c:["s","d","f","x","v"],v:["d","f","g","c","b"],b:["f","g","h","v","n"],n:["g","h","j","b","m"],m:["h","j","k","n"]}}getCommonPrefixes(){return["un","vor","nach","bei","mit","ab","an","auf","aus","ein","gegen","hinter","neben","ueber","unter","zwischen","selbst"]}getCommonSuffixes(){return["haus","platz","strasse","weg","hof","berg","tal","feld","stadt","dorf","heim","werk","bau","anlage","zentrum"]}getCommonWords(){return new Set(["kranken","kinder","frauen","maenner","alt","neu","gross","klein","hoch","tief","lang","kurz","breit","schmal","dick","duenn","stark","schwach","schnell","langsam","heiss","kalt","warm","auto","bahn","bus","zug","flug","schiff","rad","motor","wasser","feuer","erde","luft","licht","schatten","sonne","mond","tag","nacht","morgen","abend","mittag","zeit","jahr","monat"])}}class L extends k{language="english";displayName="English";supportedFeatures=["phonetic","synonyms","keyboard-neighbors","partial-words","missing-letters","extra-letters","transpositions"];normalize(n){return n.toLowerCase().trim().replace(/\s+/g," ").replace(/won't/g,"will not").replace(/can't/g,"cannot").replace(/n't/g," not").replace(/'re/g," are").replace(/'ve/g," have").replace(/'ll/g," will").replace(/'d/g," would").replace(/'m/g," am").replace(/'/g,"")}getPhoneticCode(n){const t=this.normalize(n).replace(/[^a-z]/g,"");if(t.length===0)return"";let e="",r=0;const s=t.length;for((t.startsWith("gn")||t.startsWith("kn")||t.startsWith("pn")||t.startsWith("wr"))&&(r=1);r<s&&e.length<4;){const o=t[r],i=r+1<s?t[r+1]:"",c=r>0?t[r-1]:"";switch(o){case"a":case"e":case"i":case"o":case"u":r===0&&(e+=o.toUpperCase());break;case"b":r===s-1&&c==="m"||(e+="B");break;case"c":i==="h"?(e+="X",r++):i==="i"||i==="e"||i==="y"?e+="S":e+="K";break;case"d":i==="g"?(e+="J",r++):e+="T";break;case"f":e+="F";break;case"g":i==="h"&&r!==0||(i==="n"?(e+="N",r++):i==="i"||i==="e"||i==="y"?e+="J":e+="K");break;case"h":(r===0||"aeiou".includes(c)||"aeiou".includes(i))&&(e+="H");break;case"j":e+="J";break;case"k":c!=="c"&&(e+="K");break;case"l":e+="L";break;case"m":e+="M";break;case"n":e+="N";break;case"p":i==="h"?(e+="F",r++):e+="P";break;case"q":e+="K";break;case"r":e+="R";break;case"s":i==="h"?(e+="X",r++):e+="S";break;case"t":i==="h"?(e+="0",r++):i==="i"&&r+2<s&&(t[r+2]==="a"||t[r+2]==="o")?e+="X":e+="T";break;case"v":e+="F";break;case"w":"aeiou".includes(i)&&(e+="W");break;case"x":e+="KS";break;case"y":"aeiou".includes(i)&&(e+="Y");break;case"z":e+="S";break}r++}return e||"A"}getWordVariants(n){const t=new Set,e=this.normalize(n);t.add(e),t.add(n);const r=this.getCommonEndings();for(const s of r)e.endsWith(s)&&e.length>s.length+2&&t.add(e.slice(0,-s.length));if(e.endsWith("s")&&e.length>3&&t.add(e.slice(0,-1)),e.endsWith("s")||t.add(e+"s"),e.endsWith("ing")&&e.length>5){const s=e.slice(0,-3);t.add(s),t.add(s+"e")}if(e.endsWith("ed")&&e.length>4){const s=e.slice(0,-2);t.add(s),t.add(s+"e")}if(e.length>4)for(let s=3;s<e.length;s++)t.add(e.slice(0,s));return Array.from(t)}getCommonEndings(){return["s","es","ed","ing","er","est","ly","tion","sion","ness","ment","able","ible","ful","less","ous","ious","al","ial","ic","ive","ary","ery","ory"]}getSynonyms(n){const t={doctor:["physician","medic","doc","md"],hospital:["clinic","medical center","infirmary"],school:["academy","institution","college","university"],car:["vehicle","automobile","auto"],house:["home","residence","dwelling","building"],street:["road","avenue","lane","boulevard"],city:["town","municipality","urban area"],work:["job","employment","occupation","career"],money:["cash","currency","funds","capital"],time:["duration","period","moment","hour"],big:["large","huge","enormous","massive","giant"],small:["little","tiny","miniature","petite"],fast:["quick","rapid","speedy","swift"],slow:["sluggish","gradual","leisurely"],good:["excellent","great","wonderful","fine"],bad:["poor","terrible","awful","horrible"],happy:["joyful","cheerful","glad","pleased"],sad:["unhappy","depressed","melancholy","sorrowful"]},e=this.normalize(n);return t[e]||[]}}class j extends k{language="spanish";displayName="Español";supportedFeatures=["phonetic","synonyms","keyboard-neighbors","partial-words","missing-letters","extra-letters"];normalize(n){return n.toLowerCase().trim().replace(/\s+/g," ").replace(/á/g,"a").replace(/é/g,"e").replace(/í/g,"i").replace(/ó/g,"o").replace(/ú/g,"u").replace(/ñ/g,"n").replace(/ü/g,"u")}getPhoneticCode(n){const t=this.normalize(n);if(t.length===0)return"";let e="",r="";for(let s=0;s<t.length;s++){const o=t[s],i=s<t.length-1?t[s+1]:"";let c="";switch(o){case"a":case"e":case"i":case"o":case"u":c="0";break;case"b":case"v":c="1";break;case"c":i==="h"?c="2":i==="e"||i==="i"?c="8":c="4";break;case"d":c="3";break;case"f":c="5";break;case"g":i==="u"&&s+2<t.length&&(t[s+2]==="e"||t[s+2]==="i")?c="4":i==="e"||i==="i"?c="6":c="4";break;case"h":continue;case"j":c="6";break;case"k":c="4";break;case"l":i==="l"?c="7":c="5";break;case"m":c="6";break;case"n":i==="n"?c="7":c="6";break;case"ñ":c="7";break;case"p":c="1";break;case"q":c="4";break;case"r":i==="r"||s===0?c="8":c="7";break;case"s":c="8";break;case"t":c="3";break;case"w":c="1";break;case"x":c="48";break;case"y":c="7";break;case"z":c="8";break;default:continue}c&&c!==r&&(e+=c),r=c}return e||"0"}getCommonEndings(){return["o","a","os","as","e","es","ar","er","ir","ado","ada","idos","idas","ando","endo","iendo","cion","sion","dad","tad","mente","oso","osa","ito","ita","illo","illa"]}getSynonyms(n){const t={medico:["doctor","facultativo"],hospital:["clinica","sanatorio"],escuela:["colegio","instituto"],coche:["auto","automovil","vehiculo"],casa:["hogar","vivienda","domicilio"],calle:["via","avenida","carretera"],ciudad:["urbe","poblacion","municipio"],trabajo:["empleo","ocupacion","labor"],dinero:["plata","efectivo","capital"],tiempo:["momento","periodo","duracion"],grande:["enorme","gigante","inmenso"],pequeno:["chico","diminuto","minusculo"],rapido:["veloz","ligero","acelerado"],lento:["despacio","pausado"],bueno:["excelente","magnifico","estupendo"],malo:["pesimo","terrible","horrible"]},e=this.normalize(n);return t[e]||[]}}class F extends k{language="french";displayName="Français";supportedFeatures=["phonetic","synonyms","keyboard-neighbors","partial-words","missing-letters","extra-letters"];normalize(n){return n.toLowerCase().trim().replace(/\s+/g," ").replace(/[àáâãä]/g,"a").replace(/[èéêë]/g,"e").replace(/[ìíîï]/g,"i").replace(/[òóôõö]/g,"o").replace(/[ùúûü]/g,"u").replace(/ç/g,"c").replace(/ñ/g,"n").replace(/ÿ/g,"y")}getPhoneticCode(n){const t=this.normalize(n);if(t.length===0)return"";let e="",r="";for(let s=0;s<t.length;s++){const o=t[s],i=s<t.length-1?t[s+1]:"",c=s<t.length-2?t[s+2]:"";let l="";switch(o){case"a":case"e":case"i":case"o":case"u":case"y":l="0";break;case"b":l="1";break;case"c":i==="h"?l="2":i==="e"||i==="i"?l="8":l="4";break;case"d":l="3";break;case"f":l="5";break;case"g":i==="n"?l="6":i==="u"&&(c==="e"||c==="i")?l="4":i==="e"||i==="i"?l="6":l="4";break;case"h":s===0&&(l="0");break;case"j":l="6";break;case"k":l="4";break;case"l":l="5";break;case"m":l="6";break;case"n":l="6";break;case"p":i==="h"?l="5":l="1";break;case"q":l="4";break;case"r":l="7";break;case"s":l="8";break;case"t":l="3";break;case"v":l="5";break;case"w":l="5";break;case"x":l="48";break;case"z":l="8";break;default:continue}l&&l!==r&&(e+=l),r=l}return e||"0"}getCommonEndings(){return["e","es","s","x","ent","ant","ment","tion","sion","eur","euse","teur","trice","able","ible","ique","aire","oire","ette","elle","esse","asse","isse","age","isme","iste","ite","ude","ade"]}getSynonyms(n){const t={medecin:["docteur","praticien"],hopital:["clinique","centre medical"],ecole:["etablissement","institution"],voiture:["automobile","vehicule","auto"],maison:["domicile","residence","habitation"],rue:["avenue","boulevard","voie"],ville:["cite","commune","agglomeration"],travail:["emploi","occupation","metier"],argent:["monnaie","especes","capital"],temps:["duree","periode","moment"],grand:["enorme","immense","gigantesque"],petit:["minuscule","minime","reduit"],rapide:["vite","accelere","prompt"],lent:["lentement","doucement"],bon:["excellent","parfait","formidable"],mauvais:["terrible","affreux","horrible"],heureux:["joyeux","content","ravi"],triste:["malheureux","chagrine","melancolique"]},e=this.normalize(n);return t[e]||[]}getKeyboardNeighbors(){return{a:["z","e","r","q","s"],z:["a","e","r","q","s","d"],e:["z","r","t","s","d","f"],r:["e","t","y","d","f","g"],t:["r","y","u","f","g","h"],y:["t","u","i","g","h","j"],u:["y","i","o","h","j","k"],i:["u","o","p","j","k","l"],o:["i","p","k","l","m"],p:["o","l","m"],q:["a","z","s","w","x"],s:["a","z","e","q","d","w","x","c"],d:["z","e","r","s","f","x","c","v"],f:["e","r","t","d","g","c","v","b"],g:["r","t","y","f","h","v","b","n"],h:["t","y","u","g","j","b","n"],j:["y","u","i","h","k","n"],k:["u","i","o","j","l"],l:["i","o","p","k","m"],m:["o","p","l"],w:["q","s","x"],x:["q","s","d","w","c"],c:["s","d","f","x","v"],v:["d","f","g","c","b"],b:["f","g","h","v","n"],n:["g","h","j","b"]}}}class I{static processors=new Map([["german",new x],["english",new L],["spanish",new j],["french",new F]]);static getProcessor(n){return this.processors.get(n.toLowerCase())}static getProcessors(n){return n.map(t=>this.getProcessor(t)).filter(t=>t!==void 0)}static getAvailableLanguages(){return Array.from(this.processors.keys())}static registerProcessor(n){this.processors.set(n.language.toLowerCase(),n)}static isSupported(n){return this.processors.has(n.toLowerCase())}static getProcessorInfo(){return Array.from(this.processors.values()).map(n=>({language:n.language,displayName:n.displayName,supportedFeatures:n.supportedFeatures}))}}function w(a,n,t=1/0){const e=a.length,r=n.length;if(Math.abs(e-r)>t)return t+1;if(e===0)return r;if(r===0)return e;if(a===n)return 0;let s=new Array(r+1),o=new Array(r+1);for(let i=0;i<=r;i++)s[i]=i;for(let i=1;i<=e;i++){o[0]=i;let c=i;for(let l=1;l<=r;l++){const h=a[i-1]===n[l-1]?0:1;o[l]=Math.min(o[l-1]+1,s[l]+1,s[l-1]+h),c=Math.min(c,o[l])}if(c>t)return t+1;[s,o]=[o,s]}return s[r]}function V(a,n,t=1/0){const e=a.length,r=n.length;if(Math.abs(e-r)>t)return t+1;if(e===0)return r;if(r===0)return e;if(a===n)return 0;const s=Math.max(e,r),o=[],i=s+1;for(let h=0;h<=e+1;h++)o[h]=new Array(r+2).fill(i);o[0][0]=i;for(let h=0;h<=e;h++)o[h+1][0]=i,o[h+1][1]=h;for(let h=0;h<=r;h++)o[0][h+1]=i,o[1][h+1]=h;const c=new Map;for(let h=1;h<=e;h++){let g=0;for(let f=1;f<=r;f++){const p=a[h-1],S=n[f-1],M=c.get(S)||0;let y=1;p===S&&(y=0,g=f),o[h+1][f+1]=Math.min(o[h][f]+y,o[h+1][f]+1,o[h][f+1]+1,o[M][g]+(h-M-1)+1+(f-g-1))}c.set(a[h-1],h)}const l=o[e+1][r+1];return l>t?t+1:l}function E(a,n,t=3){if(a===n)return 1;if(a.length===0||n.length===0)return 0;const e=W(a,t),r=W(n,t);if(e.length===0&&r.length===0)return 1;if(e.length===0||r.length===0)return 0;const s=new Set(e),o=new Set(r),i=new Set([...s].filter(l=>o.has(l))),c=new Set([...s,...o]);return i.size/c.size}function W(a,n){if(a.length<n)return[a];const t=[];for(let e=0;e<=a.length-n;e++)t.push(a.slice(e,e+n));return t}function N(a,n){return n===0?a===0?1:0:Math.max(0,1-a/n)}function G(a,n,t=.8,e=2){if(a===n)return!0;const r=Math.max(a.length,n.length);if(Math.abs(a.length-n.length)>e||E(a,n)<t-.2)return!1;const o=w(a,n,e);return N(o,r)>=t}function Q(a,n,t,e){const r=[],s={termToPostings:new Map,phoneticToPostings:new Map,ngramToPostings:new Map,synonymToPostings:new Map,fieldIndices:new Map,totalDocs:0,avgDocLength:0};let o=0,i=0;for(const c of a){if(!c||c.trim().length<t.minQueryLength)continue;const l=c.trim();for(const h of n){const g=h.normalize(l),f=e.has("phonetic")&&h.supportedFeatures.includes("phonetic")?h.getPhoneticCode(l):void 0,p=e.has("compound")&&h.supportedFeatures.includes("compound")?h.splitCompoundWords(l):void 0,S={id:i,word:l,normalized:g,phoneticCode:f,language:h.language,compoundParts:p&&p.length>1?p:void 0};if(r.push(S),o+=g.length,m(s.termToPostings,g,i),m(s.termToPostings,l.toLowerCase(),i),e.has("partial-words")&&h.getWordVariants(l).forEach(b=>{m(s.termToPostings,b,i)}),f&&m(s.phoneticToPostings,f,i),R(g,t.ngramSize).forEach(y=>{m(s.ngramToPostings,y,i)}),p&&p.length>1&&p.forEach(y=>{const b=h.normalize(y);m(s.termToPostings,b,i)}),e.has("synonyms")&&(h.getSynonyms(g).forEach(b=>{m(s.synonymToPostings,b,i)}),t.customSynonyms)){const b=t.customSynonyms[g];b&&b.forEach(ye=>{m(s.synonymToPostings,ye,i)})}i++}}return s.totalDocs=i,s.avgDocLength=o/Math.max(1,i),{invertedIndex:s,documents:r}}function q(a,n,t,e,r){const s=new Map,o=new Set(r.features);for(const i of e){const c=i.normalize(t.trim());J(c,a,n,s,i.language),X(c,a,n,s,i.language),o.has("phonetic")&&i.supportedFeatures.includes("phonetic")&&Y(c,i,a,n,s),o.has("synonyms")&&Z(c,a,n,s),ee(c,a,n,s,i.language,r.ngramSize),(o.has("missing-letters")||o.has("extra-letters")||o.has("transpositions"))&&te(c,a,n,s,i,r.maxEditDistance)}return Array.from(s.values())}function m(a,n,t){let e=a.get(n);e||(e={term:n,docIds:[]},a.set(n,e)),e.docIds.includes(t)||e.docIds.push(t)}function R(a,n){if(a.length<n)return[a];const t=[];for(let e=0;e<=a.length-n;e++)t.push(a.slice(e,e+n));return t}function J(a,n,t,e,r){const s=n.termToPostings.get(a);s&&s.docIds.forEach(o=>{const i=t[o];i&&(e.has(o)||e.set(o,{word:i.word,normalized:a,matchType:"exact",editDistance:0,language:r}))})}function X(a,n,t,e,r){for(const[s,o]of n.termToPostings.entries())s.startsWith(a)&&s!==a&&o.docIds.forEach(i=>{const c=t[i];c&&(e.has(i)||e.set(i,{word:c.word,normalized:s,matchType:"prefix",language:r}))})}function Y(a,n,t,e,r){const s=n.getPhoneticCode(a);if(!s)return;const o=t.phoneticToPostings.get(s);o&&o.docIds.forEach(i=>{const c=e[i];c&&(r.has(i)||r.set(i,{word:c.word,normalized:a,matchType:"phonetic",phoneticCode:s,language:n.language}))})}function Z(a,n,t,e){const r=n.synonymToPostings.get(a);r&&r.docIds.forEach(s=>{const o=t[s];o&&(e.has(s)||e.set(s,{word:o.word,normalized:a,matchType:"synonym",language:"synonym"}))})}function ee(a,n,t,e,r,s){if(a.length<s)return;const o=R(a,s),i=new Set;o.forEach(c=>{const l=n.ngramToPostings.get(c);l&&l.docIds.forEach(h=>i.add(h))}),i.forEach(c=>{const l=t[c];l&&(e.has(c)||e.set(c,{word:l.word,normalized:a,matchType:"ngram",language:r}))})}function te(a,n,t,e,r,s){for(const[o,i]of n.termToPostings.entries()){if(Math.abs(o.length-a.length)>s)continue;const c=w(a,o,s);c<=s&&i.docIds.forEach(l=>{const h=t[l];if(!h)return;const g=e.get(l);(!g||(g.editDistance||1/0)>c)&&e.set(l,{word:h.word,normalized:o,matchType:"fuzzy",editDistance:c,language:r.language})})}}function D(a,n,t){const e=[],r=t.toLowerCase(),s=n.toLowerCase();switch(a.matchType){case"exact":e.push({start:0,end:t.length,type:"exact"});break;case"prefix":const o=Math.min(s.length,t.length);e.push({start:0,end:o,type:"prefix"});break;case"substring":const i=r.indexOf(s);i!==-1&&e.push({start:i,end:i+s.length,type:"substring"});break;case"fuzzy":e.push(...ne(s,r,"fuzzy"));break;case"ngram":e.push(...se(s,r));break;case"phonetic":case"synonym":case"compound":e.push({start:0,end:t.length,type:a.matchType});break}return ae(e)}function ne(a,n,t){const e=[];let r=0,s=0;for(;r<a.length&&s<n.length;)if(a[r]===n[s]){const o=s;let i=s+1;for(r++,s++;r<a.length&&s<n.length&&a[r]===n[s];)i++,r++,s++;e.push({start:o,end:i,type:t})}else s++;return e}function se(a,n){const t=[];for(let r=0;r<=a.length-3;r++){const s=a.slice(r,r+3);let o=0;for(;;){const i=n.indexOf(s,o);if(i===-1)break;t.push({start:i,end:i+3,type:"ngram"}),o=i+1}}return t}function ae(a){if(a.length===0)return[];const n=[...a].sort((e,r)=>e.start-r.start),t=[n[0]];for(let e=1;e<n.length;e++){const r=n[e],s=t[t.length-1];r.start<=s.end?(s.end=Math.max(s.end,r.end),A(r.type)>A(s.type)&&(s.type=r.type)):t.push(r)}return t}function A(a){return{exact:10,prefix:9,substring:8,fuzzy:7,ngram:6,phonetic:5,compound:4,synonym:3}[a]||0}function re(a,n,t="highlight"){if(!n||n.length===0)return v(a);let e="",r=0;for(const s of n){s.start>r&&(e+=v(a.slice(r,s.start)));const o=a.slice(s.start,s.end);e+=`<mark class="${t} ${t}--${s.type}">${v(o)}</mark>`,r=s.end}return r<a.length&&(e+=v(a.slice(r))),e}function v(a){const n=typeof document<"u"?document.createElement("div"):null;return n?(n.textContent=a,n.innerHTML):a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}class B{cache;capacity;constructor(n=100){this.cache=new Map,this.capacity=n}get(n){if(!this.cache.has(n))return;const t=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,t),t}set(n,t){if(this.cache.has(n)&&this.cache.delete(n),this.cache.set(n,t),this.cache.size>this.capacity){const e=this.cache.keys().next().value;e!==void 0&&this.cache.delete(e)}}has(n){return this.cache.has(n)}clear(){this.cache.clear()}get size(){return this.cache.size}getStats(){return{size:this.cache.size,capacity:this.capacity,utilization:this.cache.size/this.capacity}}}class _{cache;hits=0;misses=0;constructor(n=100){this.cache=new B(n)}getCacheKey(n,t,e){const r=e?JSON.stringify(e):"";return`${n}|${t||"default"}|${r}`}get(n,t,e){const r=this.getCacheKey(n,t,e),s=this.cache.get(r);return s?this.hits++:this.misses++,s}set(n,t,e,r){const s=this.getCacheKey(n,e,r);this.cache.set(s,t)}clear(){this.cache.clear(),this.hits=0,this.misses=0}getStats(){const n=this.cache.getStats(),t=this.hits+this.misses,e=t>0?this.hits/t:0;return{...n,hits:this.hits,misses:this.misses,hitRate:e}}}function H(a=[],n={}){const t=P(n.config);$(t);const e=new Set(t.features),r=n.languageProcessors||I.getProcessors(t.languages);if(r.length===0)throw new Error(`No language processors found for: ${t.languages.join(", ")}`);const s={base:[],variantToBase:new Map,phoneticToBase:new Map,ngramIndex:new Map,synonymMap:new Map,languageProcessors:new Map,config:t};r.forEach(h=>{s.languageProcessors.set(h.language,h)});const o=new Set;let i=0;for(const h of a){if(!h||h.trim().length<t.minQueryLength)continue;const g=h.trim();if(!o.has(g.toLowerCase())){o.add(g.toLowerCase()),s.base.push(g);for(const f of r)ie(g,f,s,t,e);i++,n.onProgress&&n.onProgress(i,a.length)}}if(n.useInvertedIndex||t.useInvertedIndex||a.length>=1e4){const{invertedIndex:h,documents:g}=Q(a,r,t,e);s.invertedIndex=h,s.documents=g}if(t.enableCache!==!1){const h=t.cacheSize||100;s._cache=new _(h)}return s}function ie(a,n,t,e,r){const s=n.normalize(a);if(d(t.variantToBase,s,a),d(t.variantToBase,a.toLowerCase(),a),d(t.variantToBase,a,a),r.has("partial-words")&&n.getWordVariants(a).forEach(c=>{d(t.variantToBase,c,a)}),r.has("phonetic")&&n.supportedFeatures.includes("phonetic")){const i=n.getPhoneticCode(a);i&&d(t.phoneticToBase,i,a)}if(U(s,e.ngramSize).forEach(i=>{d(t.ngramIndex,i,a)}),r.has("compound")&&n.supportedFeatures.includes("compound")&&n.splitCompoundWords(a).forEach(c=>{c!==a&&d(t.variantToBase,n.normalize(c),a)}),r.has("synonyms")&&(n.getSynonyms(s).forEach(c=>{d(t.synonymMap,c,a)}),e.customSynonyms)){const c=e.customSynonyms[s];c&&c.forEach(l=>{d(t.synonymMap,l,a)})}}function d(a,n,t){a.has(n)||a.set(n,new Set),a.get(n).add(t)}function K(a,n,t,e={}){const r=a.config,s=t||e.maxResults||r.maxResults,o=e.fuzzyThreshold||r.fuzzyThreshold;if(!n||n.trim().length<r.minQueryLength)return[];if(a._cache){const g=a._cache.get(n,s,e);if(g)return g}const c=(e.languages||r.languages).map(g=>a.languageProcessors.get(g)).filter(g=>g!==void 0);if(c.length===0)return[];if(a.invertedIndex&&a.documents){const g=de(a,n,s,o,c,e);return a._cache&&a._cache.set(n,g,s,e),g}const l=new Map;for(const g of c){const f=g.normalize(n.trim());oe(f,a,l,g.language),ce(f,a,l,g.language),le(f,g,a,l),he(f,a,l),ge(f,a,l,g.language,r.ngramSize),(r.features.includes("missing-letters")||r.features.includes("extra-letters")||r.features.includes("transpositions"))&&ue(f,a,l,g,r)}const h=Array.from(l.values()).map(g=>O(g,n,o,e)).filter(g=>g!==null).sort((g,f)=>f.score-g.score).slice(0,s);return a._cache&&a._cache.set(n,h,s,e),h}function oe(a,n,t,e){const r=n.variantToBase.get(a);r&&r.forEach(o=>{t.has(o)||t.set(o,{word:o,normalized:a,matchType:"exact",editDistance:0,language:e})});const s=a.toLowerCase();for(const o of n.base)o.toLowerCase()===s&&(t.has(o)||t.set(o,{word:o,normalized:a,matchType:"exact",editDistance:0,language:e}))}function ce(a,n,t,e){for(const[r,s]of n.variantToBase.entries())r.startsWith(a)&&r!==a&&s.forEach(o=>{t.has(o)||t.set(o,{word:o,normalized:r,matchType:"prefix",language:e})})}function le(a,n,t,e){if(!n.supportedFeatures.includes("phonetic"))return;const r=n.getPhoneticCode(a);if(r){const s=t.phoneticToBase.get(r);s&&s.forEach(o=>{e.has(o)||e.set(o,{word:o,normalized:a,matchType:"phonetic",phoneticCode:r,language:n.language})})}}function he(a,n,t){const e=n.synonymMap.get(a);e&&e.forEach(r=>{t.has(r)||t.set(r,{word:r,normalized:a,matchType:"synonym",language:"synonym"})})}function ge(a,n,t,e,r){if(a.length<r)return;const s=U(a,r),o=new Set;s.forEach(i=>{const c=n.ngramIndex.get(i);c&&c.forEach(l=>o.add(l))}),o.forEach(i=>{t.has(i)||t.set(i,{word:i,normalized:a,matchType:"ngram",language:e})})}function ue(a,n,t,e,r){const s=r.maxEditDistance;for(const[o,i]of n.variantToBase.entries())if(Math.abs(o.length-a.length)<=s){const c=w(a,o,s);c<=s&&i.forEach(l=>{const h=t.get(l);(!h||(h.editDistance||1/0)>c)&&t.set(l,{word:l,normalized:o,matchType:"fuzzy",editDistance:c,language:e.language})})}}function O(a,n,t,e){const r=fe(a,n);if(r<t)return null;const s={display:a.word,baseWord:a.word,isSynonym:a.matchType==="synonym",score:r,language:a.language,_debug_matchType:a.matchType};return e?.includeHighlights&&(s.highlights=D(a,n,a.word)),s}function fe(a,n){const t=n.length,e=a.word.length,r=Math.max(t,e);let s=.5;switch(a.matchType){case"exact":s=1;break;case"prefix":s=.9-(e-t)/(r*2);break;case"substring":s=.8;break;case"phonetic":s=.7;break;case"fuzzy":a.editDistance!==void 0&&(s=Math.max(.3,1-a.editDistance/r));break;case"synonym":s=.6;break;case"compound":s=.75;break;case"ngram":s=E(n.toLowerCase(),a.normalized,3)*.8;break}return e<=t+2&&a.matchType!=="exact"&&(s+=.1),Math.min(1,Math.max(0,s))}function U(a,n){if(a.length<n)return[a];const t=[];for(let e=0;e<=a.length-n;e++)t.push(a.slice(e,e+n));return t}function de(a,n,t,e,r,s){if(!a.invertedIndex||!a.documents)throw new Error("Inverted index not available");return q(a.invertedIndex,a.documents,n,r,a.config).map(c=>O(c,n,e,s)).filter(c=>c!==null).sort((c,l)=>l.score-c.score).slice(0,t)}function me(a,n={}){const t=H(a,{config:{languages:n.languages||["german"],performance:n.performance||"balanced",maxResults:n.maxResults||5}});return{search:(e,r)=>K(t,e,r),index:t}}const pe="1.0.2";u.BaseLanguageProcessor=k,u.DEFAULT_CONFIG=z,u.EnglishProcessor=L,u.FrenchProcessor=F,u.GermanProcessor=x,u.LRUCache=B,u.LanguageRegistry=I,u.PERFORMANCE_CONFIGS=C,u.SearchCache=_,u.SpanishProcessor=j,u.VERSION=pe,u.areStringsSimilar=G,u.buildFuzzyIndex=H,u.calculateDamerauLevenshteinDistance=V,u.calculateHighlights=D,u.calculateLevenshteinDistance=w,u.calculateNgramSimilarity=E,u.createFuzzySearch=me,u.distanceToSimilarity=N,u.formatHighlightedHTML=re,u.getSuggestions=K,u.mergeConfig=P,Object.defineProperty(u,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=fuzzyfindjs.min.js.map
