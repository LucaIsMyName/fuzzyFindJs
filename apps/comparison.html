<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FuzzyFindJS vs Fuse.js - Quality & Performance Comparison</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- FuzzyFindJS -->
  <script src="../dist/umd/fuzzyfindjs.min.js"></script>
  <!-- Fuse.js local -->
  <script src="./js/fuse.js"></script>
  <style>
    .metric-card {
      transition: all 0.3s ease;
    }

    .metric-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .progress-bar {
      transition: width 0.3s ease;
    }

    .result-good {
      color: #10b981;
    }

    .result-warning {
      color: #f59e0b;
    }

    .result-bad {
      color: #ef4444;
    }

    /* Custom scrollbar for query results */
    .overflow-y-auto::-webkit-scrollbar {
      width: 6px;
    }

    .overflow-y-auto::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 3px;
    }

    .overflow-y-auto::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 3px;
    }

    .overflow-y-auto::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 0, 0, 0.3);
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen">
  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-4xl font-bold text-gray-900 mb-2">‚ö° FuzzyFindJS vs Fuse.js</h1>
      <p class="text-gray-600">Comprehensive quality & performance comparison with diverse query types</p>
    </div>

    <!-- Controls -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <!-- Dataset Size -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Dataset Size: <span id="datasetSizeLabel" class="text-blue-600">10,000</span>
          </label>
          <input type="range" id="datasetSize" min="1000" max="100000" step="1000" value="10000"
            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" />
          <div class="flex justify-between text-xs text-gray-500 mt-1">
            <span>1K</span>
            <span>100K</span>
          </div>
        </div>

        <!-- Performance Mode -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Performance Mode
          </label>
          <select id="performanceMode" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm">
            <option value="fast">Fast</option>
            <option value="balanced" selected>Balanced (Recommended)</option>
            <option value="comprehensive">Comprehensive</option>
          </select>
        </div>

        <!-- Query Count -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Test Queries: <span id="queryCountLabel" class="text-blue-600">100</span>
          </label>
          <input type="range" id="queryCount" min="10" max="1000" step="10" value="100"
            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" />
        </div>

        <!-- Run Button -->
        <div class="flex items-end">
          <button id="runTest"
            class="w-full px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed">
            üöÄ Run Test
          </button>
        </div>
      </div>

      <!-- Progress Bar -->
      <div id="progressContainer" class="mt-4 hidden">
        <div class="flex justify-between text-sm text-gray-600 mb-1">
          <span id="progressText">Preparing...</span>
          <span id="progressPercent">0%</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2">
          <div id="progressBar" class="progress-bar bg-blue-600 h-2 rounded-full" style="width: 0%"></div>
        </div>
      </div>
    </div>

    <!-- Comparison Results -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      <!-- FuzzyFindJS Results -->
      <div class="bg-white rounded-lg shadow-sm border-2 border-blue-200 p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-bold text-gray-900">FuzzyFindJS</h2>
          <span id="fuzzyWinner"
            class="hidden px-3 py-1 bg-green-100 text-green-800 text-sm font-semibold rounded-full">üèÜ Winner</span>
        </div>
        <div class="space-y-4">
          <div>
            <div class="text-sm text-gray-600 mb-1">Index Build Time</div>
            <div id="fuzzyBuildTime" class="text-2xl font-bold text-gray-900">-</div>
          </div>
          <div>
            <div class="text-sm text-gray-600 mb-1">Avg Query Time</div>
            <div id="fuzzyAvgQueryTime" class="text-2xl font-bold text-gray-900">-</div>
          </div>
          <div>
            <div class="text-sm text-gray-600 mb-1">Queries/Second</div>
            <div id="fuzzyQueriesPerSec" class="text-2xl font-bold text-gray-900">-</div>
          </div>
          <div>
            <div class="text-sm text-gray-600 mb-1">Index Size</div>
            <div id="fuzzyIndexSize" class="text-2xl font-bold text-gray-900">-</div>
          </div>
          <div>
            <div class="text-sm text-gray-600 mb-1">Total Time</div>
            <div id="fuzzyTotalTime" class="text-2xl font-bold text-gray-900">-</div>
          </div>
        </div>
      </div>

      <!-- Fuse.js Results -->
      <div class="bg-white rounded-lg shadow-sm border-2 border-orange-200 p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-bold text-gray-900">Fuse.js</h2>
          <span id="fuseWinner"
            class="hidden px-3 py-1 bg-green-100 text-green-800 text-sm font-semibold rounded-full">üèÜ Winner</span>
        </div>
        <div class="space-y-4">
          <div>
            <div class="text-sm text-gray-600 mb-1">Index Build Time</div>
            <div id="fuseBuildTime" class="text-2xl font-bold text-gray-900">-</div>
          </div>
          <div>
            <div class="text-sm text-gray-600 mb-1">Avg Query Time</div>
            <div id="fuseAvgQueryTime" class="text-2xl font-bold text-gray-900">-</div>
          </div>
          <div>
            <div class="text-sm text-gray-600 mb-1">Queries/Second</div>
            <div id="fuseQueriesPerSec" class="text-2xl font-bold text-gray-900">-</div>
          </div>
          <div>
            <div class="text-sm text-gray-600 mb-1">Index Size</div>
            <div id="fuseIndexSize" class="text-2xl font-bold text-gray-900">-</div>
          </div>
          <div>
            <div class="text-sm text-gray-600 mb-1">Total Time</div>
            <div id="fuseTotalTime" class="text-2xl font-bold text-gray-900">-</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance Comparison Chart -->
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Performance Comparison</h3>
      <div class="space-y-4">
        <div>
          <div class="flex justify-between text-sm mb-2">
            <span class="text-gray-600">Index Build Time</span>
            <span id="buildComparison" class="font-semibold">-</span>
          </div>
          <div class="flex gap-2">
            <div class="flex-1">
              <div class="w-full bg-gray-200 rounded-full h-6 relative overflow-hidden">
                <div id="fuzzyBuildBar" class="bg-blue-500 h-6 rounded-full flex items-center justify-end pr-2"
                  style="width: 0%">
                  <span class="text-xs text-white font-semibold"></span>
                </div>
              </div>
              <div class="text-xs text-gray-500 mt-1">FuzzyFindJS</div>
            </div>
            <div class="flex-1">
              <div class="w-full bg-gray-200 rounded-full h-6 relative overflow-hidden">
                <div id="fuseBuildBar" class="bg-orange-500 h-6 rounded-full flex items-center justify-end pr-2"
                  style="width: 0%">
                  <span class="text-xs text-white font-semibold"></span>
                </div>
              </div>
              <div class="text-xs text-gray-500 mt-1">Fuse.js</div>
            </div>
          </div>
        </div>

        <div>
          <div class="flex justify-between text-sm mb-2">
            <span class="text-gray-600">Average Query Time</span>
            <span id="queryComparison" class="font-semibold">-</span>
          </div>
          <div class="flex gap-2">
            <div class="flex-1">
              <div class="w-full bg-gray-200 rounded-full h-6 relative overflow-hidden">
                <div id="fuzzyQueryBar" class="bg-blue-500 h-6 rounded-full flex items-center justify-end pr-2"
                  style="width: 0%">
                  <span class="text-xs text-white font-semibold"></span>
                </div>
              </div>
              <div class="text-xs text-gray-500 mt-1">FuzzyFindJS</div>
            </div>
            <div class="flex-1">
              <div class="w-full bg-gray-200 rounded-full h-6 relative overflow-hidden">
                <div id="fuseQueryBar" class="bg-orange-500 h-6 rounded-full flex items-center justify-end pr-2"
                  style="width: 0%">
                  <span class="text-xs text-white font-semibold"></span>
                </div>
              </div>
              <div class="text-xs text-gray-500 mt-1">Fuse.js</div>
            </div>
          </div>
        </div>

        <div>
          <div class="flex justify-between text-sm mb-2">
            <span class="text-gray-600">Total Time</span>
            <span id="totalComparison" class="font-semibold">-</span>
          </div>
          <div class="flex gap-2">
            <div class="flex-1">
              <div class="w-full bg-gray-200 rounded-full h-6 relative overflow-hidden">
                <div id="fuzzyTotalBar" class="bg-blue-500 h-6 rounded-full flex items-center justify-end pr-2"
                  style="width: 0%">
                  <span class="text-xs text-white font-semibold"></span>
                </div>
              </div>
              <div class="text-xs text-gray-500 mt-1">FuzzyFindJS</div>
            </div>
            <div class="flex-1">
              <div class="w-full bg-gray-200 rounded-full h-6 relative overflow-hidden">
                <div id="fuseTotalBar" class="bg-orange-500 h-6 rounded-full flex items-center justify-end pr-2"
                  style="width: 0%">
                  <span class="text-xs text-white font-semibold"></span>
                </div>
              </div>
              <div class="text-xs text-gray-500 mt-1">Fuse.js</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sample Query Results -->
    <div id="sampleResults" class="bg-white border border-gray-200 rounded-lg p-6 hidden">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">üìã Sample Query Results (showing up to 50 queries)</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- FuzzyFindJS Results -->
        <div>
          <h4 class="text-md font-semibold text-blue-600 mb-3 flex items-center">
            <span class="mr-2">‚ö°</span> FuzzyFindJS
          </h4>
          <div id="fuzzyQueryResults" class="space-y-2 text-sm">
            <!-- Results will be inserted here -->
          </div>
        </div>

        <!-- Fuse.js Results -->
        <div>
          <h4 class="text-md font-semibold text-orange-600 mb-3 flex items-center">
            <span class="mr-2">üîç</span> Fuse.js
          </h4>
          <div id="fuseQueryResults" class="space-y-2 text-sm">
            <!-- Results will be inserted here -->
          </div>
        </div>
      </div>
    </div>

    <!-- About the Test -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
      <h3 class="text-lg font-semibold text-blue-900 mb-3">About This Comparison</h3>
      <div class="space-y-2 text-sm text-blue-800">
        <p><strong>Test Methodology:</strong> Both libraries are tested with diverse, realistic queries including
          cities, names, phrases, technical terms, typos, and partial matches.</p>
        <p><strong>FuzzyFindJS:</strong> Multi-language fuzzy search with phonetic matching, compound word splitting,
          and inverted index for large datasets.</p>
        <p><strong>Fuse.js:</strong> Popular lightweight fuzzy-search library with configurable threshold and scoring.
        </p>
        <p><strong>Query Types:</strong> Exact matches, prefixes, fuzzy (typos), partial matches, city names, person
          names, phrases, and technical API-style terms.</p>
        <p><strong>Performance Modes:</strong></p>
        <ul class="ml-4 space-y-1">
          <li>‚Ä¢ <strong>Fast:</strong> Minimal features, fastest indexing (~50-100ms for 10k items), good for real-time
            use</li>
          <li>‚Ä¢ <strong>Balanced:</strong> More features enabled, slower indexing (~500ms-2s), better accuracy</li>
          <li>‚Ä¢ <strong>Comprehensive:</strong> All features, slowest indexing (~2-10s), maximum accuracy</li>
        </ul>
        <p><strong>Note:</strong> Results may vary based on dataset characteristics, query patterns, and browser
          performance.</p>
      </div>
    </div>
  </div>

  <script>
    // DOM Elements
    const datasetSizeInput = document.getElementById('datasetSize');
    const datasetSizeLabel = document.getElementById('datasetSizeLabel');
    const performanceModeSelect = document.getElementById('performanceMode');
    const queryCountInput = document.getElementById('queryCount');
    const queryCountLabel = document.getElementById('queryCountLabel');
    const runTestButton = document.getElementById('runTest');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const progressPercent = document.getElementById('progressPercent');

    // State
    let fuzzyIndex = null;
    let fuseIndex = null;
    let fuzzyResults = null;
    let fuseResults = null;

    // Update labels
    datasetSizeInput.addEventListener('input', (e) => {
      datasetSizeLabel.textContent = parseInt(e.target.value).toLocaleString();
    });

    queryCountInput.addEventListener('input', (e) => {
      queryCountLabel.textContent = parseInt(e.target.value).toLocaleString();
    });

    // Generate random word
    function generateWord(length = 8) {
      const chars = 'abcdefghijklmnopqrstuvwxyz';
      let word = '';
      for (let i = 0; i < length; i++) {
        word += chars[Math.floor(Math.random() * chars.length)];
      }
      return word;
    }

    // Generate diverse dataset with realistic data
    function generateDataset(size) {
      const wordsSet = new Set(); // Use Set to ensure uniqueness

      // Real-world data patterns
      const cities = [
        'New York', 'Los Angeles', 'Chicago', 'Houston', 'Phoenix', 'Philadelphia',
        'San Antonio', 'San Diego', 'Dallas', 'San Jose', 'Austin', 'Jacksonville',
        'Fort Worth', 'Columbus', 'Charlotte', 'San Francisco', 'Indianapolis', 'Seattle',
        'Denver', 'Washington', 'Boston', 'Nashville', 'Baltimore', 'Oklahoma City',
        'Portland', 'Las Vegas', 'Louisville', 'Milwaukee', 'Albuquerque', 'Tucson',
        'Fresno', 'Sacramento', 'Kansas City', 'Mesa', 'Atlanta', 'Omaha',
        'Colorado Springs', 'Raleigh', 'Miami', 'Long Beach', 'Virginia Beach', 'Oakland',
        'Minneapolis', 'Tampa', 'Tulsa', 'Arlington', 'New Orleans', 'Wichita',
        'Cleveland', 'Bakersfield', 'Vienna', 'M√∂dling', 'Linz', 'Neusiedl',
        'Graz', 'Innsbruck', 'Verling'
      ];
      
      const names = [
        'John Smith', 'Emma Johnson', 'Michael Williams', 'Sophia Brown', 'James Jones',
        'Olivia Garcia', 'Robert Miller', 'Ava Davis', 'William Rodriguez', 'Isabella Martinez',
        'David Hernandez', 'Mia Lopez', 'Richard Gonzalez', 'Charlotte Wilson', 'Joseph Anderson',
        'Amelia Thomas', 'Thomas Taylor', 'Harper Moore', 'Charles Jackson', 'Evelyn Martin',
        'Christopher Lee', 'Abigail Perez', 'Daniel Thompson', 'Emily White', 'Matthew Harris',
        'Peter M√ºller', 'Francois Dupont', 'Markus Schwarz', 'Lena Meyer', 'Oliver Fischer',
        'Sophie Schmidt', 'Erich Hoffmann'
      ];
      
      const phrases = [
        'machine learning', 'artificial intelligence', 'data science', 'web development',
        'mobile application', 'cloud computing', 'database management', 'user interface',
        'software engineering', 'computer vision', 'natural language', 'deep learning',
        'neural network', 'big data', 'cyber security', 'blockchain technology',
        'quantum computing', 'internet of things', 'augmented reality', 'virtual reality',
        'virtual insanity'
      ];
      
      const prefixes = [
        'test', 'data', 'user', 'admin', 'system', 'app', 'web', 'api',
        'service', 'client', 'auth', 'config', 'handler', 'manager',
        'controller', 'provider', 'factory', 'helper', 'util', 'processor',
        'validator', 'formatter', 'parser'
      ];
      
      const suffixes = [
        'handler', 'manager', 'service', 'controller', 'provider', 'factory',
        'helper', 'util', 'processor', 'validator', 'formatter', 'parser', 'utils'
      ];

      // First, add all base items (guaranteed unique)
      cities.forEach(city => wordsSet.add(city));
      names.forEach(name => wordsSet.add(name));
      phrases.forEach(phrase => wordsSet.add(phrase));

      // Generate unique compound words and random words until we reach target size
      let counter = 0;
      while (wordsSet.size < size) {
        const type = counter % 3;
        
        if (type === 0) {
          // API-style compound words with unique numbers
          const word = prefixes[counter % prefixes.length] + 
                      suffixes[counter % suffixes.length] + 
                      counter;
          wordsSet.add(word);
        } else if (type === 1) {
          // Underscore-separated with unique numbers
          const word = prefixes[counter % prefixes.length] + '_' + 
                      suffixes[(counter + 1) % suffixes.length] + '_' + 
                      counter;
          wordsSet.add(word);
        } else {
          // Random technical terms (naturally unique)
          wordsSet.add(generateWord(5 + (counter % 10)));
        }
        counter++;
      }

      return Array.from(wordsSet);
    }

    // Generate diverse test queries with realistic patterns
    function generateQueries(dataset, count) {
      const queries = [];
      const queryTypes = ['exact', 'prefix', 'fuzzy', 'partial', 'phrase', 'city', 'name', 'technical'];

      // Predefined realistic queries
      const realisticQueries = [
        'New Yor', 'Los Angel', 'San Fran', 'Chicag', // City prefixes
        'John Smit', 'Emma John', 'Michael Will', // Name prefixes
        'machine learn', 'artificial intel', 'data scien', // Phrase prefixes
        'api_controller', 'systemservice', 'userhandler', // Technical terms
        'machne learning', 'artifical intelligence', 'dta science', // Typos
        'Nwe York', 'Los Angelos', 'Chicgo', // City typos
        'Jhon Smith', 'Ema Johnson', 'Micheal Williams', // Name typos
        'api', 'system', 'Toledo', 'user', 'data', 'web', 'service', // Short queries
        'api_cntrlll', 'controller1234', 'handler5678', 'service9012', 'hanler5678', // API with numbers
        'San', 'Los', 'New', 'Fort', 'Colorado', 'Viena', 'Vienna', 'Lin', // City partials
      ];

      for (let i = 0; i < count; i++) {
        // Mix realistic queries with generated ones
        if (i < realisticQueries.length && i < count / 2) {
          queries.push(realisticQueries[i]);
        } else {
          const randomWord = dataset[Math.floor(Math.random() * dataset.length)];
          const queryType = queryTypes[i % queryTypes.length];

          switch (queryType) {
            case 'exact':
              queries.push(randomWord);
              break;
            case 'prefix':
              const prefixLen = Math.min(randomWord.length - 1, 3 + (i % 6));
              queries.push(randomWord.substring(0, prefixLen));
              break;
            case 'fuzzy':
              // Introduce realistic typo
              const typoWord = randomWord.split('');
              if (typoWord.length > 3) {
                const pos = 1 + Math.floor(Math.random() * (typoWord.length - 2));
                // Swap, delete, or replace
                const typoType = i % 3;
                if (typoType === 0 && pos < typoWord.length - 1) {
                  // Swap adjacent chars
                  [typoWord[pos], typoWord[pos + 1]] = [typoWord[pos + 1], typoWord[pos]];
                } else if (typoType === 1) {
                  // Delete char
                  typoWord.splice(pos, 1);
                } else {
                  // Replace char
                  typoWord[pos] = generateWord(1);
                }
              }
              queries.push(typoWord.join(''));
              break;
            case 'partial':
              if (randomWord.length > 4) {
                const start = Math.floor(Math.random() * (randomWord.length - 4));
                queries.push(randomWord.substring(start, start + 4 + (i % 4)));
              } else {
                queries.push(randomWord);
              }
              break;
            case 'phrase':
            case 'city':
            case 'name':
            case 'technical':
              // Use word as-is or with prefix
              queries.push(randomWord.substring(0, Math.min(randomWord.length, 5 + (i % 5))));
              break;
          }
        }
      }

      return queries;
    }

    // Update progress
    function updateProgress(percent, text) {
      progressBar.style.width = percent + '%';
      progressPercent.textContent = Math.round(percent) + '%';
      progressText.textContent = text;
    }

    // Format time
    function formatTime(ms) {
      if (ms < 1) return (ms * 1000).toFixed(2) + '¬µs';
      if (ms < 1000) return ms.toFixed(2) + 'ms';
      return (ms / 1000).toFixed(2) + 's';
    }

    // Format size
    function formatSize(bytes) {
      if (bytes < 1024) return bytes + 'B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + 'KB';
      return (bytes / (1024 * 1024)).toFixed(2) + 'MB';
    }

    // Get performance class
    function getPerformanceClass(ms, threshold1 = 1, threshold2 = 5) {
      if (ms < threshold1) return 'result-good';
      if (ms < threshold2) return 'result-warning';
      return 'result-bad';
    }

    // Run performance test for both libraries
    async function runTest() {
      runTestButton.disabled = true;
      progressContainer.classList.remove('hidden');

      const datasetSize = parseInt(datasetSizeInput.value);
      const performanceMode = performanceModeSelect.value;
      const queryCount = parseInt(queryCountInput.value);

      try {
        // Step 1: Generate dataset
        updateProgress(5, 'Generating dataset...');
        await new Promise(resolve => setTimeout(resolve, 100));
        const dataset = generateDataset(datasetSize);

        // Step 2: Generate queries
        updateProgress(10, 'Generating test queries...');
        await new Promise(resolve => setTimeout(resolve, 100));
        const queries = generateQueries(dataset, queryCount);

        // Step 3: Test FuzzyFindJS
        updateProgress(20, 'Building FuzzyFindJS index...');
        await new Promise(resolve => setTimeout(resolve, 100));

        const fuzzyBuildStart = performance.now();
        fuzzyIndex = FuzzyFindJS.buildFuzzyIndex(dataset, {
          config: {
            performance: performanceMode,
            maxResults: 10,
            languages: ['english'],  // Single language for fair comparison
            features: ['phonetic', 'compound', 'partial-words', 'phrase-matching']  // Enable all features for quality
          }
        });
        const fuzzyBuildTime = performance.now() - fuzzyBuildStart;

        updateProgress(35, 'Running FuzzyFindJS queries...');
        const fuzzyQueryTimes = [];
        const fuzzySampleResults = [];

        for (let i = 0; i < queries.length; i++) {
          const queryStart = performance.now();
          const results = FuzzyFindJS.getSuggestions(fuzzyIndex, queries[i], 10);
          const queryTime = performance.now() - queryStart;
          fuzzyQueryTimes.push(queryTime);

          // Capture up to 50 results for display
          if (i < Math.min(50, queries.length)) {
            fuzzySampleResults.push({
              query: queries[i],
              results: results.slice(0, 3), // Top 3 results
              time: queryTime
            });
          }

          if (i % 10 === 0) {
            updateProgress(35 + (i / queries.length) * 15, `FuzzyFindJS: ${i}/${queries.length}`);
            await new Promise(resolve => setTimeout(resolve, 0));
          }
        }

        // Step 4: Test Fuse.js
        updateProgress(50, 'Building Fuse.js index...');
        await new Promise(resolve => setTimeout(resolve, 100));

        const fuseBuildStart = performance.now();
        fuseIndex = new Fuse(dataset, {
          threshold: 0.3,
          keys: [''],
          includeScore: true
        });
        const fuseBuildTime = performance.now() - fuseBuildStart;

        updateProgress(65, 'Running Fuse.js queries...');
        const fuseQueryTimes = [];
        const fuseSampleResults = [];

        for (let i = 0; i < queries.length; i++) {
          const queryStart = performance.now();
          const results = fuseIndex.search(queries[i], { limit: 10 });
          const queryTime = performance.now() - queryStart;
          fuseQueryTimes.push(queryTime);

          // Capture up to 50 results for display
          if (i < Math.min(50, queries.length)) {
            fuseSampleResults.push({
              query: queries[i],
              results: results.slice(0, 3).map(r => ({ display: r.item, score: r.score })), // Top 3 results
              time: queryTime
            });
          }

          if (i % 10 === 0) {
            updateProgress(65 + (i / queries.length) * 25, `Fuse.js: ${i}/${queries.length}`);
            await new Promise(resolve => setTimeout(resolve, 0));
          }
        }

        // Step 5: Calculate statistics
        updateProgress(95, 'Calculating statistics...');
        await new Promise(resolve => setTimeout(resolve, 100));

        // FuzzyFindJS stats
        fuzzyQueryTimes.sort((a, b) => a - b);
        const fuzzyAvgQueryTime = fuzzyQueryTimes.reduce((a, b) => a + b, 0) / fuzzyQueryTimes.length;
        const fuzzyQueriesPerSec = 1000 / fuzzyAvgQueryTime;
        const fuzzyIndexSize = JSON.stringify(fuzzyIndex).length;
        const fuzzyTotalTime = fuzzyBuildTime + fuzzyQueryTimes.reduce((a, b) => a + b, 0);

        // Fuse.js stats
        fuseQueryTimes.sort((a, b) => a - b);
        const fuseAvgQueryTime = fuseQueryTimes.reduce((a, b) => a + b, 0) / fuseQueryTimes.length;
        const fuseQueriesPerSec = 1000 / fuseAvgQueryTime;
        const fuseIndexSize = JSON.stringify(fuseIndex).length;
        const fuseTotalTime = fuseBuildTime + fuseQueryTimes.reduce((a, b) => a + b, 0);

        fuzzyResults = {
          buildTime: fuzzyBuildTime,
          avgQueryTime: fuzzyAvgQueryTime,
          queriesPerSec: fuzzyQueriesPerSec,
          indexSize: fuzzyIndexSize,
          totalTime: fuzzyTotalTime,
          sampleResults: fuzzySampleResults
        };

        fuseResults = {
          buildTime: fuseBuildTime,
          avgQueryTime: fuseAvgQueryTime,
          queriesPerSec: fuseQueriesPerSec,
          indexSize: fuseIndexSize,
          totalTime: fuseTotalTime,
          sampleResults: fuseSampleResults
        };

        // Step 6: Display results
        updateProgress(100, 'Complete!');
        displayComparisonResults(fuzzyResults, fuseResults);
        displaySampleResults(fuzzySampleResults, fuseSampleResults);

        setTimeout(() => {
          progressContainer.classList.add('hidden');
          runTestButton.disabled = false;
        }, 1000);

      } catch (error) {
        console.error('Test failed:', error);
        alert('Test failed: ' + error.message);
        progressContainer.classList.add('hidden');
        runTestButton.disabled = false;
      }
    }

    // Display comparison results
    function displayComparisonResults(fuzzy, fuse) {
      // FuzzyFindJS metrics
      document.getElementById('fuzzyBuildTime').textContent = formatTime(fuzzy.buildTime);
      document.getElementById('fuzzyBuildTime').className = 'text-2xl font-bold ' + getPerformanceClass(fuzzy.buildTime, 100, 500);

      document.getElementById('fuzzyAvgQueryTime').textContent = formatTime(fuzzy.avgQueryTime);
      document.getElementById('fuzzyAvgQueryTime').className = 'text-2xl font-bold ' + getPerformanceClass(fuzzy.avgQueryTime);

      document.getElementById('fuzzyQueriesPerSec').textContent = Math.round(fuzzy.queriesPerSec).toLocaleString();
      document.getElementById('fuzzyIndexSize').textContent = formatSize(fuzzy.indexSize);
      document.getElementById('fuzzyTotalTime').textContent = formatTime(fuzzy.totalTime);

      // Fuse.js metrics
      document.getElementById('fuseBuildTime').textContent = formatTime(fuse.buildTime);
      document.getElementById('fuseBuildTime').className = 'text-2xl font-bold ' + getPerformanceClass(fuse.buildTime, 100, 500);

      document.getElementById('fuseAvgQueryTime').textContent = formatTime(fuse.avgQueryTime);
      document.getElementById('fuseAvgQueryTime').className = 'text-2xl font-bold ' + getPerformanceClass(fuse.avgQueryTime);

      document.getElementById('fuseQueriesPerSec').textContent = Math.round(fuse.queriesPerSec).toLocaleString();
      document.getElementById('fuseIndexSize').textContent = formatSize(fuse.indexSize);
      document.getElementById('fuseTotalTime').textContent = formatTime(fuse.totalTime);

      // Determine winner
      const fuzzyWinner = fuzzy.totalTime < fuse.totalTime;
      document.getElementById('fuzzyWinner').classList.toggle('hidden', !fuzzyWinner);
      document.getElementById('fuseWinner').classList.toggle('hidden', fuzzyWinner);

      // Comparison bars
      const maxBuildTime = Math.max(fuzzy.buildTime, fuse.buildTime);
      const maxQueryTime = Math.max(fuzzy.avgQueryTime, fuse.avgQueryTime);
      const maxTotalTime = Math.max(fuzzy.totalTime, fuse.totalTime);

      // Build time comparison
      const fuzzyBuildPercent = (fuzzy.buildTime / maxBuildTime * 100);
      const fuseBuildPercent = (fuse.buildTime / maxBuildTime * 100);
      document.getElementById('fuzzyBuildBar').style.width = fuzzyBuildPercent + '%';
      document.getElementById('fuseBuildBar').style.width = fuseBuildPercent + '%';
      document.getElementById('fuzzyBuildBar').querySelector('span').textContent = formatTime(fuzzy.buildTime);
      document.getElementById('fuseBuildBar').querySelector('span').textContent = formatTime(fuse.buildTime);

      const buildDiff = ((Math.abs(fuzzy.buildTime - fuse.buildTime) / Math.max(fuzzy.buildTime, fuse.buildTime)) * 100).toFixed(1);
      const buildFaster = fuzzy.buildTime < fuse.buildTime ? 'FuzzyFindJS' : 'Fuse.js';
      document.getElementById('buildComparison').textContent = `${buildFaster} ${buildDiff}% faster`;
      document.getElementById('buildComparison').className = 'font-semibold ' + (fuzzy.buildTime < fuse.buildTime ? 'text-blue-600' : 'text-orange-600');

      // Query time comparison
      const fuzzyQueryPercent = (fuzzy.avgQueryTime / maxQueryTime * 100);
      const fuseQueryPercent = (fuse.avgQueryTime / maxQueryTime * 100);
      document.getElementById('fuzzyQueryBar').style.width = fuzzyQueryPercent + '%';
      document.getElementById('fuseQueryBar').style.width = fuseQueryPercent + '%';
      document.getElementById('fuzzyQueryBar').querySelector('span').textContent = formatTime(fuzzy.avgQueryTime);
      document.getElementById('fuseQueryBar').querySelector('span').textContent = formatTime(fuse.avgQueryTime);

      const queryDiff = ((Math.abs(fuzzy.avgQueryTime - fuse.avgQueryTime) / Math.max(fuzzy.avgQueryTime, fuse.avgQueryTime)) * 100).toFixed(1);
      const queryFaster = fuzzy.avgQueryTime < fuse.avgQueryTime ? 'FuzzyFindJS' : 'Fuse.js';
      document.getElementById('queryComparison').textContent = `${queryFaster} ${queryDiff}% faster`;
      document.getElementById('queryComparison').className = 'font-semibold ' + (fuzzy.avgQueryTime < fuse.avgQueryTime ? 'text-blue-600' : 'text-orange-600');

      // Total time comparison
      const fuzzyTotalPercent = (fuzzy.totalTime / maxTotalTime * 100);
      const fuseTotalPercent = (fuse.totalTime / maxTotalTime * 100);
      document.getElementById('fuzzyTotalBar').style.width = fuzzyTotalPercent + '%';
      document.getElementById('fuseTotalBar').style.width = fuseTotalPercent + '%';
      document.getElementById('fuzzyTotalBar').querySelector('span').textContent = formatTime(fuzzy.totalTime);
      document.getElementById('fuseTotalBar').querySelector('span').textContent = formatTime(fuse.totalTime);

      const totalDiff = ((Math.abs(fuzzy.totalTime - fuse.totalTime) / Math.max(fuzzy.totalTime, fuse.totalTime)) * 100).toFixed(1);
      const totalFaster = fuzzy.totalTime < fuse.totalTime ? 'FuzzyFindJS' : 'Fuse.js';
      document.getElementById('totalComparison').textContent = `${totalFaster} ${totalDiff}% faster`;
      document.getElementById('totalComparison').className = 'font-semibold ' + (fuzzy.totalTime < fuse.totalTime ? 'text-blue-600' : 'text-orange-600');
    }

    // Display sample query results
    function displaySampleResults(fuzzySamples, fuseSamples) {
      const sampleResultsDiv = document.getElementById('sampleResults');
      const fuzzyResultsDiv = document.getElementById('fuzzyQueryResults');
      const fuseResultsDiv = document.getElementById('fuseQueryResults');

      // Show the section
      sampleResultsDiv.classList.remove('hidden');

      // Clear previous results
      fuzzyResultsDiv.innerHTML = '';
      fuseResultsDiv.innerHTML = '';

      // Display FuzzyFindJS results
      fuzzySamples.forEach((sample, index) => {
        const resultHTML = `
          <div class="border-l-2 border-blue-400 pl-3 py-2 bg-blue-50 rounded h-24 overflow-y-auto">
            <div class="font-semibold text-gray-700 mb-1">
              Query ${index + 1}: "${sample.query}" <span class="text-xs text-gray-500">(${sample.time.toFixed(2)}ms)</span>
            </div>
            <div class="text-xs text-gray-600 space-y-1">
              ${sample.results.length > 0
            ? sample.results.map(r => `<div>‚Üí ${r.display} <span class="text-gray-400">(score: ${r.score.toFixed(2)})</span></div>`).join('')
            : '<div class="text-gray-400">No results</div>'}
            </div>
          </div>
        `;
        fuzzyResultsDiv.innerHTML += resultHTML;
      });

      // Display Fuse.js results
      fuseSamples.forEach((sample, index) => {
        const resultHTML = `
          <div class="border-l-2 border-orange-400 pl-3 py-2 bg-orange-50 rounded h-24 overflow-y-auto">
            <div class="font-semibold text-gray-700 mb-1">
              Query ${index + 1}: "${sample.query}" <span class="text-xs text-gray-500">(${sample.time.toFixed(2)}ms)</span>
            </div>
            <div class="text-xs text-gray-600 space-y-1">
              ${sample.results.length > 0
            ? sample.results.map(r => `<div>‚Üí ${r.display} <span class="text-gray-400">(score: ${r.score ? r.score.toFixed(2) : 'N/A'})</span></div>`).join('')
            : '<div class="text-gray-400">No results</div>'}
            </div>
          </div>
        `;
        fuseResultsDiv.innerHTML += resultHTML;
      });
    }

    // Event listeners
    runTestButton.addEventListener('click', runTest);
  </script>
</body>

</html>